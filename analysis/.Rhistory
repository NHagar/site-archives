mutate(slope = bylines-lag(bylines)) %>%
ggplot(aes(month, slope)) +
stat_smooth()
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
ggplot(aes(month, slope))
line
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
ggplot(aes(month, slope)) +
geom_line()
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
ggplot(aes(month, slope)) +
geom_smooth()
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
ggplot(aes(month, slope)) +
geom_smooth(formula='y~poly(x, 2)')
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
ggplot(aes(month)) +
geom_line(y=rollmean(slope, 3))
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
ggplot(aes(month, slope)) +
geom_line(y=rollmean(slope, 3))
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
mutate(smoothed=rollmean(slope, 3, na.pad=T))
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
mutate(smoothed=rollmean(slope, 3, na.pad=T)) %>%
ggplot(aes(month, smoothed)) +
geom_line()
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
mutate(smoothed=rollmean(slope, 10, na.pad=T)) %>%
ggplot(aes(month, smoothed)) +
geom_line()
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
mutate(smoothed=rollmean(slope, 50, na.pad=T)) %>%
ggplot(aes(month, smoothed)) +
geom_line()
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
mutate(smoothed=rollmean(slope, 10, na.pad=T)) %>%
ggplot(aes(month, smoothed)) +
geom_line()
knitr::opts_chunk$set(echo = TRUE)
#Generating normalized curve
##Unique bylines per month
mo %>%
summarize(bylines=n_distinct(byline)) %>%
ggplot(aes(month, bylines)) +
geom_line()
library(tidyverse)
library(tidyverse)
library(lubridate)
library(zoo)
#Replicating charts
df <- read_csv('../thinkprogress/full-info-thinkprogress.csv') %>% select(link, hed, subhed, sections, byline, pub_date, datetime, text_body, tags)
#Replicating charts
df <- read_csv('../thinkprogress/full-info-thinkprogress.csv') %>% select(link, hed, subhed, sections, byline, pub_date, datetime, text_body, tags)
##Group by month
mo <- df %>%
group_by(month = floor_date(datetime, unit = "month"))
#Generating normalized curve
##Unique bylines per month
mo %>%
summarize(bylines=n_distinct(byline)) %>%
ggplot(aes(month, bylines)) +
geom_line()
mo %>%
summarize(bylines=n_distinct(bylines)) %>%
mutate(slope=bylines-lag(bylines)) %>%
ggplot(aes(month,slope)) +
geom_line()
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope=bylines-lag(bylines)) %>%
ggplot(aes(month,slope)) +
geom_line()
install.packages('pracma')
library(pracma)
mo
mo %>%
summarize(bylines=n_distinct(byline)) %>%
pull(bylines) %>%
approx_entropy(., edim=2, r=0.2*sd(.))
mo %>%
summarize(bylines=n_distinct(byline))
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines))
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines)) %>%
ggplot(aes(bylines, slope)) +
geom_point()
##Stories per month
mo %>%
summarize(stories=n()) %>%
ggplot(aes(month, stories)) +
geom_line()
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories)) %>%
ggplot(aes(stories, slope)) +
geom_point()
mo
mo %>% mutate(year=year(month))
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories)) %>%
ggplot(aes(stories, slope)) +
geom_point()
##Stores per author per month
mo %>%
summarize(storiesper=n()/n_distinct(byline))
mo %>%
summarize(stories=n())
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month)) %>%
ggplot(aes(stories, slope), color=year) +
geom_point()
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month)) %>%
ggplot(aes(stories, slope, color=year)) +
geom_point()
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month), stage=ntile(year, 4)) %>%
ggplot(aes(stories, slope, color=year)) +
geom_point()
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month), stage=ntile(year, 4)) %>%
ggplot(aes(stories, slope, color=stage)) +
geom_point()
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month), stage=ntile(year, 4)) %>%
ggplot(aes(stories, slope, series=stage)) +
geom_point()
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month), stage=ntile(year, 4)) %>%
ggplot(aes(stories, slope, color=stage)) +
geom_point()
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month), stage=ntile(year, 4)) %>%
ggplot(aes(stories, slope, color=stage)) +
geom_point()+ scale_color_hue(h = c(180, 300))
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month), stage=ntile(year, 4)) %>%
ggplot(aes(stories, slope, color=stage)) +
geom_point() + scale_color_hue(h = c(180, 300))
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month), stage=as_factor(ntile(year, 4))) %>%
ggplot(aes(stories, slope, color=stage)) +
geom_point() + scale_color_hue(h = c(180, 300))
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), year=year(month), stage=as_factor(ntile(year, 4))) %>%
ggplot(aes(stories, slope, color=stage)) +
geom_point()
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), stage=as_factor(ntile(month, 4))) %>%
ggplot(aes(stories, slope, color=stage)) +
geom_point()
mo %>%
summarize(stories=n()) %>%
mutate(stage=as_factor(ntile(month,4)))
mo %>%
summarize(stories=n()) %>%
mutate(slope = stories-lag(stories), stage=as_factor(ntile(month, 4))) %>%
ggplot(aes(stories, slope, color=stage)) +
geom_point()
mo %>%
summarize(bylines=n_distinct(byline)) %>%
mutate(slope = bylines-lag(bylines), stage=as_factor(ntile(month, 4))) %>%
ggplot(aes(bylines, slope, color=stage)) +
geom_point()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(tidyverse)
library(lubridate)
library(zoo)
library(pracma)
df <- read_csv('../thinkprogress/full-info-thinkprogress.csv')
df
df %>% write_csv('tp_recode_test.csv')
citr:::insert_citation()
library(tidyverse)
df <- read_csv("../pacific-standard/ps-archive.csv")
df
library(lubridate)
df <- read_csv("../pacific-standard/ps-archive.csv")
df
date("2009-09-10")
df %>% filter(pub_date>=date("04-01-2016"))
df %>% filter(pub_date>=date("2016-04-01"))
df %>% filter((pub_date>=date("2016-04-01")) & (pub_date<=date("2017-02-28")))
df %>% filter((pub_date>=date("2016-04-01")) & (pub_date<=date("2017-02-28"))) %>% write_csv('ps_check.csv')
df %>% filter((pub_date>=date("2016-04-01")) & (pub_date<=date("2017-02-28"))) %>% select(link, hed, sections, byline, pub_date, tags) %>% write_csv('ps_check.csv')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(zoo)
df <- read_csv('../pacific-standard/ps-archive-patched.csv')
df <- df %>%
mutate(monthyear=as.yearmon(pub_date), weekyear=paste(week(pub_date), year(pub_date), sep=' '))
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=1, fill=0) %>%
separate(sections, into=c('s1','s2','s3', 's4'), sep=';') %>%
gather(`s1`:`s4`, key='hierarchy', value='section') %>%
separate(tags, into=c('t1','t2','t3', 't4', 't5', 't6', 't7', 't8', 't9', 't10', 't11', 't12', 't13', 't14', 't15', 't16', 't17', 't18', 't19', 't20', 't21', 't22', 't23', 't24', 't25'), sep=';') %>%
gather(`t1`:`t25`, key='thierarchy', value='tag') %>%
group_by(monthyear) %>%
summarize(story_count=n(),
byline=n_distinct(byline_updated),
sections=n_distinct(section),
tags=n_distinct(tag),
storiesper=story_count/byline,
count_short=sum(`1`),
count_med=sum(`2`),
count_long=sum(`3`))
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=1, fill=0)
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=c(1), fill=0)
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=T, fill=0)
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
separate(sections, into=c('s1','s2','s3', 's4'), sep=';') %>%
gather(`s1`:`s4`, key='hierarchy', value='section') %>%
separate(tags, into=c('t1','t2','t3', 't4', 't5', 't6', 't7', 't8', 't9', 't10', 't11', 't12', 't13', 't14', 't15', 't16', 't17', 't18', 't19', 't20', 't21', 't22', 't23', 't24', 't25'), sep=';') %>%
gather(`t1`:`t25`, key='thierarchy', value='tag') %>%
group_by(monthyear) %>%
summarize(story_count=n(),
byline=n_distinct(byline_updated),
sections=n_distinct(section),
tags=n_distinct(tag),
storiesper=story_count/byline,
count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
df
df %>% group_by(monthyear) %>% summarize(n())
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
separate(sections, into=c('s1','s2','s3', 's4'), sep=';') %>%
gather(`s1`:`s4`, key='hierarchy', value='section') %>%
separate(tags, into=c('t1','t2','t3', 't4', 't5', 't6', 't7', 't8', 't9', 't10', 't11', 't12', 't13', 't14', 't15', 't16', 't17', 't18', 't19', 't20', 't21', 't22', 't23', 't24', 't25'), sep=';') %>%
gather(`t1`:`t25`, key='thierarchy', value='tag') %>%
group_by(monthyear) %>%
summarize(sections=n_distinct(section),
tags=n_distinct(tag),
count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0)
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
summarize(count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
group_by(month_year) %>%
summarize(count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
group_by(monthyear) %>%
summarize(count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
df %>%
separate(sections, into=c('s1','s2','s3', 's4'), sep=';') %>%
gather(`s1`:`s4`, key='hierarchy', value='section') %>%
separate(tags, into=c('t1','t2','t3', 't4', 't5', 't6', 't7', 't8', 't9', 't10', 't11', 't12', 't13', 't14', 't15', 't16', 't17', 't18', 't19', 't20', 't21', 't22', 't23', 't24', 't25'), sep=';') %>%
gather(`t1`:`t25`, key='thierarchy', value='tag') %>%
group_by(monthyear) %>%
summarize(sections=n_distinct(section),
tags=n_distinct(tag))
df %>%
group_by(monthyear) %>%
summarize(story_count=n(),
byline=n_distinct(byline_updated),
storiesper=story_count/byline)
ldf <- df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
group_by(monthyear) %>%
summarize(count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
ldf <- df %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
group_by(monthyear) %>%
summarize(count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
tdf <- df %>%
separate(sections, into=c('s1','s2','s3', 's4'), sep=';') %>%
gather(`s1`:`s4`, key='hierarchy', value='section') %>%
separate(tags, into=c('t1','t2','t3', 't4', 't5', 't6', 't7', 't8', 't9', 't10', 't11', 't12', 't13', 't14', 't15', 't16', 't17', 't18', 't19', 't20', 't21', 't22', 't23', 't24', 't25'), sep=';') %>%
gather(`t1`:`t25`, key='thierarchy', value='tag') %>%
group_by(monthyear) %>%
summarize(sections=n_distinct(section),
tags=n_distinct(tag))
adf <- df %>%
group_by(monthyear) %>%
summarize(story_count=n(),
byline=n_distinct(byline_updated),
storiesper=story_count/byline)
left_join(left_join(adf, ldf), tdf)
agg_stats <- left_join(left_join(adf, ldf), tdf)
agg_stats
agg_stats %>%
ggplot(aes(monthyear, story_count)) +
geom_line()
agg_stats %>%
ggplot(aes(monthyear, story_count)) +
geom_smooth(method='lm') +
geom_line()
agg_stats %>%
ggplot(aes(monthyear, story_count)) +
geom_smooth(method='auto') +
geom_line()
agg_stats
agg_stats %>%
gather(count_short:count_long, key='length', value='stories')
agg_stats %>%
gather(count_short:count_long, key='length', value='stories') %>%
ggplot(aes(monthyear, stories, color=length)) +
geom_line()
?mutate_at
agg_stats %>%
mutate(count_short=count_short/story_count, count_med=count_med/story_count, count_long/count_long/story_count) %>%
gather(count_short:count_long, key='length', value='stories') %>%
ggplot(aes(monthyear, stories, color=length)) +
geom_line()
agg_stats %>%
mutate(count_short=count_short/story_count, count_med=count_med/story_count, count_long=count_long/story_count) %>%
gather(count_short:count_long, key='length', value='stories') %>%
ggplot(aes(monthyear, stories, color=length)) +
geom_line()
agg_stats %>%
mutate(count_short=count_short/story_count, count_med=count_med/story_count, count_long=count_long/story_count) %>%
gather(count_short:count_long, key='length', value='stories') %>%
ggplot(aes(monthyear, stories, color=length)) +
geom_smooth() +
geom_line()
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(zoo)
df <- read_csv('../pacific-standard/ps-archive-patched.csv')
df <- read_csv('../pacific-standard/ps-archive-patched.csv')
df2 <- read_csv('../thinkprogress/full-info-thinkprogress.csv')
rbind(df, df2)
df
df2
df <- df %>% select(-X1, -`Unnamed: 0`)
rbind(df, df2)
?rbind
df2 <-
bind_rows(df, df2)
bind_rows(df, df2)
df2 <- df2 %>% select(-pub_date) %>% rename("pub_date"=datetime)
bind_rows(df, df2)
df <- df %>% select(-X1, -`Unnamed: 0`) %>% mutate(pub='Pacific Standard')
df <- read_csv('../pacific-standard/ps-archive-patched.csv')
df2 <- read_csv('../thinkprogress/full-info-thinkprogress.csv')
#Iron out dataframe specifics
df <- df %>% select(-X1, -`Unnamed: 0`) %>% mutate(pub='Pacific Standard')
df2 <- df2 %>% select(-pub_date) %>% rename("pub_date"=datetime) %>% mutate('Think Progress')
d <- bind_rows(df, df2)
d <- d %>%
mutate(monthyear=as.yearmon(pub_date), weekyear=paste(week(pub_date), year(pub_date), sep=' '))
ldf <- d %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
group_by(pub, monthyear) %>%
summarize(count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
tdf <- d %>%
separate(sections, into=c('s1','s2','s3', 's4'), sep=';') %>%
gather(`s1`:`s4`, key='hierarchy', value='section') %>%
separate(tags, into=c('t1','t2','t3', 't4', 't5', 't6', 't7', 't8', 't9', 't10', 't11', 't12', 't13', 't14', 't15', 't16', 't17', 't18', 't19', 't20', 't21', 't22', 't23', 't24', 't25'), sep=';') %>%
gather(`t1`:`t25`, key='thierarchy', value='tag') %>%
group_by(pub, monthyear) %>%
summarize(sections=n_distinct(section),
tags=n_distinct(tag))
adf <- d %>%
group_by(pub, monthyear) %>%
summarize(story_count=n(),
byline=n_distinct(byline_updated),
storiesper=story_count/byline)
agg_stats <- left_join(left_join(adf, ldf), tdf)
agg_stats
adf
d %>% filter(pub=='Think Progress')
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(zoo)
df <- read_csv('../pacific-standard/ps-archive-patched.csv')
df2 <- read_csv('../thinkprogress/full-info-thinkprogress.csv')
#Iron out dataframe specifics
df <- df %>% select(-X1, -`Unnamed: 0`) %>% mutate(pub='Pacific Standard')
df2 <- df2 %>% select(-pub_date) %>% rename("pub_date"=datetime) %>% mutate(pub='Think Progress')
d <- bind_rows(df, df2)
d <- d %>%
mutate(monthyear=as.yearmon(pub_date), weekyear=paste(week(pub_date), year(pub_date), sep=' '))
ldf <- d %>%
select(-html_body) %>%
mutate(words=log(str_count(text_body, ' ')), words_classification=ntile(words, 3)) %>%
select(-text_body) %>%
spread(key=words_classification, value=words_classification, fill=0) %>%
group_by(pub, monthyear) %>%
summarize(count_short=sum(ifelse(`1`>0,1,0)),
count_med=sum(ifelse(`2`>0,1,0)),
count_long=sum(ifelse(`3`>0,1,0)))
tdf <- d %>%
separate(sections, into=c('s1','s2','s3', 's4'), sep=';') %>%
gather(`s1`:`s4`, key='hierarchy', value='section') %>%
separate(tags, into=c('t1','t2','t3', 't4', 't5', 't6', 't7', 't8', 't9', 't10', 't11', 't12', 't13', 't14', 't15', 't16', 't17', 't18', 't19', 't20', 't21', 't22', 't23', 't24', 't25'), sep=';') %>%
gather(`t1`:`t25`, key='thierarchy', value='tag') %>%
group_by(pub, monthyear) %>%
summarize(sections=n_distinct(section),
tags=n_distinct(tag))
adf <- d %>%
group_by(pub, monthyear) %>%
summarize(story_count=n(),
byline=n_distinct(byline_updated),
storiesper=story_count/byline)
agg_stats <- left_join(left_join(adf, ldf), tdf)
agg_stats
agg_stats %>%
ggplot(aes(monthyear, story_count, color=pub)) +
geom_smooth(method='auto') +
geom_line()
agg_stats %>%
ggplot(aes(monthyear, tags, color=pub)) +
geom_smooth(method='auto') +
geom_line()
df2
df2
d
